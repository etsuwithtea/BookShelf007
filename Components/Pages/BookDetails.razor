@page "/books/details/{Id:int}"
@using BookShelf007.Models
@using BookShelf007.Services
@using Microsoft.AspNetCore.Components.Web
@inject IBookService BookService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Book Details</PageTitle>

<div class="container mt-2 mt-md-4">
    @if (book == null)
    {
        <div class="alert alert-danger">Book not found.</div>
        <button class="btn btn-outline-secondary" @onclick="@BackToList">
            <i class="bi bi-arrow-left"></i> Back to List
        </button>
    }
    else
    {
        <div class="card">
            <div class="card-header bg-black text-white text-center shadow-sm">
                <h3>@book.Title</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 text-center">
                        <img src="@(string.IsNullOrEmpty(book.ImageUrl) ? "/images/Books/default.png" : book.ImageUrl)" 
                             class="img-fluid rounded shadow-sm mb-3" alt="@book.Title" style="max-height: 400px;">
                    </div>
                    <div class="col-md-8">
                        <p><strong>Author:</strong> @book.Author</p>
                        <p><strong>Published Date:</strong> @book.PublishedDate.ToString("dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture)</p>
                        <hr />
                        <p><strong>Description:</strong></p>
                        <p>@book.Description</p>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent border-top-0">
                <button class="btn btn-outline-warning me-2" @onclick="() => EditBook(book.Id)">
                    <i class="bi bi-pencil"></i> Edit
                </button>
                <button class="btn btn-outline-danger me-2" @onclick="() => DeleteBook(book.Id)">
                    <i class="bi bi-trash"></i> Delete
                </button>
                <button class="btn btn-outline-secondary" @onclick="() => BackToList()">
                    <i class="bi bi-arrow-left"></i> Back to List
                </button>
            </div>
        </div>
    }
</div>

@code {
    [Inject] private IJSRuntime JSRuntime { get; set; } = default!;
    [Parameter]
    public int Id { get; set; }
    private Book? book;

    protected override void OnInitialized()
    {
        book = BookService.GetBookById(Id);
    }

    private void BackToList()
    {
        NavigationManager.NavigateTo("/books");
    }

    private void EditBook(int id)
    {
        NavigationManager.NavigateTo($"/books/edit/{id}");
    }

    private async Task DeleteBook(int id)
    {
        var confirmed = await JSRuntime.InvokeAsync<bool>("confirm", "Are you sure you want to delete this book?");
        if (confirmed)
        {
            BookService.DeleteBook(id);
            NavigationManager.NavigateTo("/books");
        }
    }
}
